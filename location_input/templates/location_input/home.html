{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://unpkg.com/alpinejs" defer></script>
    <script src="{% static 'location_input/js/alpine_global_store_init.js' %}"></script>
    <script type="module" src="{% static 'location_input/js/map_script.js' %}" defer></script>

    <meta charset="UTF-8">
    <title>Zettar</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>[x-cloak] { display: none !important; }</style>
    
    
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDxQ51BfivW16FpJSX99-TFVlM5lsuK8N0&callback=initMap&loading=async"></script>

</head>
<body x-data class="font-[Inter] bg-gray-50 min-h-screen">

    {% include 'partials/header.html' %}

    <main class="flex flex-col h-[calc(100vh-80px)] max-w-7xl mx-auto p-4 space-y-6">

        <div class="flex flex-1 gap-6">

            <div class="w-2/3 h-full">
                <div class="bg-white rounded-2xl shadow h-full">
                    <div id="map" class="w-full h-full rounded-2xl"></div>
                </div>
            </div>

  
            <div class="w-1/3 h-full flex flex-col gap-6">
                <div class="bg-white rounded-2xl shadow p-4">
                    <h2 class="text-xl font-semibold mb-2">Instantly Access Grid Application Insights</h2>
                    <p class="text-gray-700">
                        With Zettar, just drop a pin on your site, choose your substation type, and instantly see up-to-date data on existing grid connection applications at the nearest substations. Clear, fast, and hassle-free.
                    </p>
                </div>


                <div class="bg-white rounded-2xl shadow p-4">
                    <h2 class="text-xl font-semibold mb-2">1. Select Connection Type</h2>
                    <fieldset class="space-y-3">
                        <legend class="sr-only">Connection Type</legend>

                        <label class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="connection_type" value="secondary" class="accent-blue-600" @change="$store.app.connectionType = 'primary'">
                        <span class="text-gray-800 font-medium">Primary</span>
                        </label>

                        <label class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="connection_type" value="bsp" class="accent-blue-600" @change="$store.app.connectionType = 'bsp'">
                        <span class="text-gray-800 font-medium">Bulk Supply Point (BSP)</span>
                        </label>

                        <label class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="connection_type" value="gsp" class="accent-blue-600" @change="$store.app.connectionType = 'gsp'">
                        <span class="text-gray-800 font-medium">Grid Supply Point (GSP)</span>
                        </label>
                    </fieldset>
                </div>

                <div class="bg-white rounded-2xl shadow p-4 space-y-2">
                    <h2 class="text-xl font-semibold">2. Select a Location</h2>
                    <p class="text-gray-700">
                        Click anywhere on the map to drop a pin at your desired site location. Zettar will automatically find the nearest substation that matches your selected type.
                    </p>
                </div>


                <div class="bg-white rounded-2xl shadow p-4 flex-1 overflow-auto">
                    <h2 class="text-xl font-semibold mb-2">3. Generate Insights</h2>
                    <button type="button"
                        class="bg-blue-600 text-white px-6 py-3 rounded-2xl text-lg font-semibold hover:bg-blue-700 transition duration-200 w-full"
                        @click="$store.app.generateInsights()">
                        Run Connection Check
                    </button>
                </div>

            </div>

            


        </div>

        <!-- ✅ This goes directly under the two-column layout -->
            <div 
                id="estimate-box"
                x-show="$store.app.showInsights"
                x-transition
                x-cloak  
                class="bg-white rounded-2xl shadow p-6 mt-6 mb-6 max-w-7xl mx-auto w-full"
            >
                <h2 class="text-xl font-semibold mb-4">Connection Insights</h2>

                    <p class="text-3xl font-extrabold text-green-600 mb-4">
                    <span x-text="$store.app.nearestSubstationName"></span>
                    </p>
                    <p class="text-gray-700 text-lg mb-4">is your nearest substation.</p>


                <div class="text-gray-800 space-y-2 text-lg">
                    <!-- 🔍 Show insights only if there are any applications -->
                    <template x-if="$store.app.demandApplicationSum || $store.app.generationApplicationSum">
                        <div>
                            <p>
                                🔌 <strong x-text="$store.app.demandApplicationSum"></strong> demand applications requesting 
                                <strong x-text="$store.app.demandCapacityMW + ' MW'"></strong>
                            </p>
                            <p>
                                ⚡ <strong x-text="$store.app.generationApplicationSum"></strong> generation applications proposing 
                                <strong x-text="$store.app.generationCapacityMW + ' MW'"></strong>
                            </p>
                        </div>
                    </template>

                    <!-- 🛑 Fallback message when both counts are 0 or missing -->
                    <template x-if="!$store.app.demandApplicationSum && !$store.app.generationApplicationSum">
                        <p class="italic text-gray-600">
                            There are currently no active applications for connections to this site.
                        </p>
                    </template>
                </div>

            </div>

    </main>

</body>

</html>
